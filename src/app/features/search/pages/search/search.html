<div class="w-full max-w-5xl mx-auto bg-white dark:bg-gray-900 shadow-xl rounded-2xl p-4 sm:p-8 md:p-10 min-h-[60vh]">
  
  <h1 class="text-xl sm:text-2xl font-bold text-gray-800 dark:text-white mb-6">Búsqueda</h1>

  <form class="space-y-4 w-full">
    <label for="termino" class="block text-sm font-medium text-gray-700 dark:text-gray-300">
      Busque por documento
    </label>

    <div class="flex flex-col sm:flex-row gap-3">
      
      <select
        [(ngModel)]="tipoDocumento"
        name="tipoDocumento"
        class="w-full sm:w-auto px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-white"
      >
        <option value="1">DNI</option>
        <option value="4">C. Extranjería</option> <option value="6">RUC</option>
        <option value="7">Pasaporte</option>
      </select>

      <input
        id="termino"
        type="text"
        [(ngModel)]="terminoBusqueda"
        name="termino"
        class="flex-1 w-full px-4 py-2 border border-gray-300 dark:border-gray-700 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-800 dark:text-white"
        placeholder="Nro. documento..." 
      />

      <button
        type="button"
        (click)="buscar()"
        class="w-full sm:w-auto bg-[#205eaa] text-white px-6 py-2 rounded-md hover:bg-[#307FDE] transition-all font-medium"
      >
        Buscar
      </button>
    </div>
  </form>

  <div *ngIf="resultados.length > 0" class="flex justify-start mt-6 mb-4">
    <button
      (click)="descargarResultadosExcel()"
      class="w-full sm:w-auto inline-flex justify-center items-center gap-2 bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-4 rounded-md shadow transition-all duration-200"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4h16v16H4V4zm4 4h8m-8 4h4m-4 4h8" />
      </svg>
      Descargar Excel
    </button>
  </div>

  <div *ngIf="cargando" class="mt-6 text-[#307FDE] dark:text-blue-400 font-semibold flex items-center justify-center sm:justify-start space-x-2">
    <svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
    </svg>
    <span>Cargando...</span>
  </div>

  <div *ngIf="resultados.length > 0" class="bg-gray-50 dark:bg-gray-800 p-4 sm:p-6 rounded-lg shadow mb-6 mt-6">
    <h2 class="text-lg sm:text-xl font-semibold text-gray-900 dark:text-white mb-4">Datos del Cliente</h2>
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4 text-sm text-gray-700 dark:text-gray-300">
      <div class="flex flex-col sm:block">
        <span class="font-medium text-gray-500 sm:text-gray-700">Nombre:</span>
        <span class="sm:ml-2 font-semibold sm:font-normal text-gray-900 dark:text-white">{{ clienteDatos.nombre }}</span>
      </div>
      <div class="flex flex-col sm:block">
        <span class="font-medium text-gray-500 sm:text-gray-700">Documento:</span>
        <span class="sm:ml-2 font-semibold sm:font-normal text-gray-900 dark:text-white">{{ clienteDatos.doc }}</span>
      </div>
      <div class="flex flex-col sm:block">
        <span class="font-medium text-gray-500 sm:text-gray-700">Tipo:</span>
        <span class="sm:ml-2 font-semibold sm:font-normal text-gray-900 dark:text-white">{{ clienteDatos.tipo }}</span>
      </div>
    </div>
  </div>

  <!-- Tabla -->

  <div *ngIf="resultados.length > 0" class="mt-8">
   <div *ngFor="let grupo of groupedResultados | keyvalue" class="mb-4 border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden">
      <!-- Cabecera del grupo -->
      <button (click)="toggleCollapse(grupo.key)"
     class="w-full flex justify-between items-center px-4 py-3 bg-blue-100 dark:bg-blue-800 text-blue-900 dark:text-blue-100 font-semibold text-left transition-colors hover:bg-blue-200 dark:hover:bg-blue-700">>
        <span class="text-sm sm:text-base break-words pr-2">{{ grupo.key }} ({{ grupo.value.length }})</span>
        <span class="text-lg">{{ isCollapsed(grupo.key) ? '+' : '−' }}</span>
      </button>

      <!-- Contenido del grupo (tabla con scroll horizontal) -->
  <div *ngIf="!isCollapsed(grupo.key)" class="w-full">
  
  <div class="overflow-auto max-h-[500px] shadow-inner border-t border-gray-200 dark:border-gray-700">
    
    <table class="min-w-[1200px] w-max divide-y divide-gray-200 dark:divide-gray-700 mb-4 table-auto">
      
      <thead class="sticky top-0 z-20 bg-gray-100 dark:bg-gray-800 shadow-sm">
        <tr>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Id Producto</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Número de Póliza</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Operation PK</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Número Crédito</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Inicio Cobertura</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Fin Cobertura</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase text-right bg-gray-100 dark:bg-gray-800">Monto Asegurado</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase text-right bg-gray-100 dark:bg-gray-800">Prima</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Moneda</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Fecha Inicio Póliza</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Fecha Fin Póliza</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Fecha Desembolso Crédito</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Fecha Vencimiento Crédito</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Fecha Proceso</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Contratante</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Canal</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Canal Vinculado</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Estado Póliza</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Evento</th>
          <th class="px-4 py-2 text-xs font-medium text-gray-500 dark:text-gray-300 uppercase bg-gray-100 dark:bg-gray-800">Estado UR</th>
        </tr>
      </thead>
      
    <tbody class="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
          <tr *ngFor="let item of grupo.value">
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.niD_PRODUCTO }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.snumerO_POLIZA }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.operationpk }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.snumerO_CREDITO }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.siniciO_CIBERTURA }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.sfiN_COBERTURA }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200 text-right">{{ item.nmontO_ASEGURADO | number:'1.2-2' }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200 text-right">{{ item.nprima | number:'1.2-2' }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.smoneda }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.inI_POLIZA }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.fiN_POLIZA || '-' }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.sfechA_DESEMBOLSO_CREDITO || '-' }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.sfechA_VENCIMIENTO_CREDITO || '-' }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.sfechA_PROCESO }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.contratante || '-' }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.canal || '-' }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.eS_CANAL_VINCULADO || '-' }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.estadO_POLIZA || '-' }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.eventO_POLIZA || '-' }}</td>
           <td class="px-4 py-2 text-sm text-gray-800 dark:text-gray-200">{{ item.estadO_UR || '-' }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

    </div>
  </div>



<div *ngIf="resultado" class="mt-6 text-green-600 dark:text-green-400 text-center sm:text-left">
     {{ resultado }}
  </div>
</div>